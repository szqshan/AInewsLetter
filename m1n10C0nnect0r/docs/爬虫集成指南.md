# Newsletterçˆ¬è™«é¡¹ç›®é›†æˆæŒ‡å—

## é¡¹ç›®æ¦‚è¿°

Newsletterçˆ¬è™«é¡¹ç›®ä½äº `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp`ï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºçˆ¬å– https://nlp.elvissaravia.com/ ç½‘ç«™Newsletteræ–‡ç« çš„é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå·²æˆåŠŸçˆ¬å–180ç¯‡æ–‡ç« ï¼ŒåŒ…å«606å¼ å›¾ç‰‡ï¼Œæ€»è€—æ—¶çº¦7åˆ†é’Ÿã€‚

## é¡¹ç›®ç»“æ„

```
çˆ¬è™«mlp/
â”œâ”€â”€ main.py                              # ç»Ÿä¸€å…¥å£ï¼ˆçˆ¬å–+ä¸Šä¼ ï¼‰
â”œâ”€â”€ config.json                          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt                     # Pythonä¾èµ–
â”œâ”€â”€ src/newsletter_system/               # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ crawler/
â”‚   â”‚   â”œâ”€â”€ newsletter_crawler.py       # ä¸»çˆ¬è™«ç±»ï¼ˆå¼‚æ­¥å¹¶å‘ï¼‰
â”‚   â”‚   â””â”€â”€ anti_detect_crawler.py      # åçˆ¬è™«ç‰ˆæœ¬
â”‚   â”œâ”€â”€ oss/
â”‚   â”‚   â”œâ”€â”€ oss_uploader.py            # MinIOä¸Šä¼ å™¨
â”‚   â”‚   â””â”€â”€ wrapper.py                  # OSSå°è£…å™¨
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.py                   # æ—¥å¿—å·¥å…·
â”‚       â””â”€â”€ file_utils.py              # æ–‡ä»¶å¤„ç†
â””â”€â”€ crawled_data/                       # çˆ¬å–çš„æ•°æ®ï¼ˆé‡è¦ï¼‰
    â”œâ”€â”€ articles/                       # 180ç¯‡æ–‡ç« 
    â”‚   â””â”€â”€ {id}_{slug}/               # å¦‚ï¼š100722694_Top-ML-Papers-of-the-Week
    â”‚       â”œâ”€â”€ content.md             # Markdownå†…å®¹
    â”‚       â”œâ”€â”€ metadata.json          # å…ƒæ•°æ®
    â”‚       â””â”€â”€ images/                # æœ¬åœ°å›¾ç‰‡
    â”‚           â””â”€â”€ img_*.jpg          # å¹³å‡3-4å¼ å›¾ç‰‡/æ–‡ç« 
    â””â”€â”€ data/
        â”œâ”€â”€ articles_metadata.json      # åŸå§‹APIå“åº”
        â”œâ”€â”€ processed_articles.json     # å®Œæ•´å¤„ç†æ•°æ®ï¼ˆä¸»è¦ç”¨è¿™ä¸ªï¼‰
        â”œâ”€â”€ recommendation_data.json    # æ¨èç³»ç»Ÿç”¨æ•°æ®
        â””â”€â”€ crawl_stats.json           # çˆ¬å–ç»Ÿè®¡

```

## æ•°æ®æ ¼å¼è¯´æ˜

### 1. æ–‡ç« å…ƒæ•°æ®æ ¼å¼ (metadata.json)
æ¯ç¯‡æ–‡ç« éƒ½æœ‰ç‹¬ç«‹çš„metadata.jsonæ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```json
{
  "id": 100722694,                    // å”¯ä¸€IDï¼Œç”¨äºå»é‡
  "title": "ğŸ¥‡Top ML Papers of the Week",
  "subtitle": "The top ML Papers of the Week (Jan 30 - Feb 5)",
  "post_date": "2023-02-05T15:50:08.035Z",
  "type": "newsletter",               // ç±»å‹ï¼šnewsletter/tutorial/paper
  "wordcount": 233,                   // å­—æ•°
  "canonical_url": "https://nlp.elvissaravia.com/p/top-ml-papers-of-the-week-64c",
  "slug": "top-ml-papers-of-the-week-64c",
  "reactions": {"â¤": 9},             // ååº”ç»Ÿè®¡
  "audience": "everyone",             // everyone/only_paid
  "postTags": [],                     // æ ‡ç­¾æ•°ç»„
  "cover_image": null,               // å°é¢å›¾ç‰‡
  "local_images": [                  // æœ¬åœ°åŒ–çš„å›¾ç‰‡åˆ—è¡¨
    {
      "original_url": "https://substackcdn.com/image/...",
      "local_path": "articles/100722694_Top-ML-Papers/images/img_0.jpg",
      "hash": "bcd2fc8be3dfbd2717416bc644c667b8",  // ç”¨äºå»é‡
      "size": 3209
    }
  ],
  "content_hash": "1af7cd42218ec06dcac37488ec443697",  // å†…å®¹å“ˆå¸Œï¼Œç”¨äºå»é‡
  "processed_date": "2025-08-07T00:21:35.900847"
}
```

### 2. ä¸»æ•°æ®æ–‡ä»¶ (processed_articles.json)
åŒ…å«æ‰€æœ‰180ç¯‡æ–‡ç« çš„å®Œæ•´æ•°æ®ï¼Œæ˜¯ä¸Šä¼ åˆ°Elasticsearchçš„ä¸»è¦æ•°æ®æºï¼š

```json
[
  {
    "id": 169333505,
    "title": "ğŸ¥‡Top AI Papers of the Week",
    "subtitle": "The Top AI Papers of the Week (July 21 - 27)",
    "description": "A weekly roundup of the most significant AI research papers",
    "post_date": "2025-07-27T14:52:20.585Z",
    "type": "newsletter",
    "wordcount": 2403,
    "reactions": {"â¤": 35, "ğŸ‘": 12},
    "postTags": [
      {
        "id": "tag-1",
        "name": "AI Papers",
        "slug": "ai-papers"
      }
    ],
    "content": "å®Œæ•´çš„Markdownå†…å®¹...",
    "local_images": [...],
    "content_hash": "...",
    // ... å…¶ä»–å­—æ®µ
  }
]
```

## ä¸MinIO/Elasticsearché›†æˆ

### 1. æ•°æ®æµç¨‹

```
çˆ¬è™«æ•°æ® â†’ é¢„å¤„ç† â†’ ä¸Šä¼ åˆ°MinIOï¼ˆå¯é€‰ï¼‰ â†’ ç´¢å¼•åˆ°Elasticsearch
```

### 2. ä¸Šä¼ åˆ°MinIO

çˆ¬è™«é¡¹ç›®è‡ªå¸¦MinIOä¸Šä¼ åŠŸèƒ½ï¼š

```bash
# ä»çˆ¬è™«é¡¹ç›®ä¸Šä¼ 
cd /Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp
python main.py upload --bucket newsletter-articles-nlp
```

é…ç½®ï¼ˆconfig.jsonï¼‰ï¼š
```json
{
  "oss": {
    "base_url": "http://localhost:9011",           // MinIO API
    "public_base_url": "http://60.205.160.74:9000", // å…¬å¼€è®¿é—®URL
    "bucket_name": "newsletter-articles-nlp",       // é»˜è®¤æ¡¶å
    "source_id": "nlp-elvissaravia"                // æ•°æ®æºæ ‡è¯†
  }
}
```

### 3. ä¸Šä¼ åˆ°Elasticsearch

ä»MinIOè¿æ¥é¡¹ç›®ä¸Šä¼ ï¼š

```bash
# åˆ‡æ¢åˆ°MinIOè¿æ¥é¡¹ç›®
cd "/Users/ruanchuhao/Downloads/Codes/NewsLetters/åˆ†æ­¥éª¤å®ç°MVP /Minioçš„è¿æ¥"

# ä¸Šä¼ çˆ¬è™«æ•°æ®åˆ°Elasticsearch
cd minio-file-manager/backend
python upload_crawled_articles.py ../../../çˆ¬è™«mlp/crawled_data/data/processed_articles.json --verify
```

### 4. å»é‡æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨åŒé‡å»é‡ï¼š
- **æ–‡ç« IDå»é‡**ï¼šåŸºäºæ–‡ç« çš„å”¯ä¸€ID (å¦‚ï¼š100722694)
- **å†…å®¹å“ˆå¸Œå»é‡**ï¼šSHA256(title + subtitle + content)

å·²çˆ¬å–çš„180ç¯‡æ–‡ç« IDèŒƒå›´ï¼š100722694 - 163724821

## å¿«é€Ÿä½¿ç”¨æŒ‡å—

### 1. è¯»å–å·²çˆ¬å–çš„æ•°æ®

```python
import json
from pathlib import Path

# è¯»å–æ‰€æœ‰æ–‡ç« æ•°æ®
crawler_data_path = Path("/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/crawled_data")
with open(crawler_data_path / "data/processed_articles.json", 'r', encoding='utf-8') as f:
    articles = json.load(f)

print(f"æ€»æ–‡ç« æ•°: {len(articles)}")  # 180ç¯‡

# è¯»å–å•ç¯‡æ–‡ç« 
article_dir = crawler_data_path / "articles/100722694_Top-ML-Papers-of-the-Week"
with open(article_dir / "metadata.json", 'r', encoding='utf-8') as f:
    metadata = json.load(f)
with open(article_dir / "content.md", 'r', encoding='utf-8') as f:
    content = f.read()
```

### 2. æ‰¹é‡ä¸Šä¼ åˆ°Elasticsearch

```python
import asyncio
from pathlib import Path
import sys

# æ·»åŠ MinIOé¡¹ç›®è·¯å¾„
sys.path.append("/Users/ruanchuhao/Downloads/Codes/NewsLetters/åˆ†æ­¥éª¤å®ç°MVP /Minioçš„è¿æ¥/minio-file-manager/backend")
from app.services.newsletter_elasticsearch_service import newsletter_elasticsearch_service

async def upload_all():
    # è¯»å–çˆ¬è™«æ•°æ®
    crawler_path = Path("/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/crawled_data")
    with open(crawler_path / "data/processed_articles.json", 'r') as f:
        articles = json.load(f)
    
    # æ‰¹é‡ä¸Šä¼ 
    result = await newsletter_elasticsearch_service.bulk_index_articles(articles)
    print(f"ä¸Šä¼ ç»“æœ: {result}")
    
asyncio.run(upload_all())
```

### 3. æ£€æŸ¥é‡å¤æ–‡ç« 

```python
async def check_duplicate(article_id: int):
    is_dup = await newsletter_elasticsearch_service.check_duplicate(
        article_id=article_id
    )
    print(f"æ–‡ç«  {article_id} {'å·²å­˜åœ¨' if is_dup else 'ä¸å­˜åœ¨'}")
```

## é‡è¦æ–‡ä»¶è·¯å¾„

### çˆ¬è™«é¡¹ç›®æ–‡ä»¶
- **ä¸»æ•°æ®æ–‡ä»¶**: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/crawled_data/data/processed_articles.json`
- **æ–‡ç« ç›®å½•**: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/crawled_data/articles/`
- **é…ç½®æ–‡ä»¶**: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/config.json`
- **çˆ¬è™«ä¸»ç¨‹åº**: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp/main.py`

### MinIOè¿æ¥é¡¹ç›®æ–‡ä»¶
- **ä¸Šä¼ è„šæœ¬**: `minio-file-manager/backend/upload_crawled_articles.py`
- **æµ‹è¯•è„šæœ¬**: `minio-file-manager/backend/test_newsletter_upload.py`
- **ESæœåŠ¡**: `minio-file-manager/backend/app/services/newsletter_elasticsearch_service.py`

## æ•°æ®ç»Ÿè®¡

åŸºäºcrawl_stats.jsonçš„ç»Ÿè®¡ï¼š
- **æ€»æ–‡ç« æ•°**: 180ç¯‡
- **æˆåŠŸå¤„ç†**: 180ç¯‡ï¼ˆ100%æˆåŠŸç‡ï¼‰
- **å¤±è´¥æ–‡ç« **: 0ç¯‡
- **å›¾ç‰‡æ€»æ•°**: 606å¼ ï¼ˆå®é™…ä¸‹è½½693å¼ ï¼ŒåŒ…å«é‡å¤ï¼‰
- **çˆ¬å–æ—¶é—´**: 436.67ç§’ï¼ˆçº¦7åˆ†é’Ÿï¼‰
- **å¹³å‡è€—æ—¶**: 2.4ç§’/æ–‡ç« 

## å¸¸è§é—®é¢˜

### 1. å¦‚ä½•é‡æ–°çˆ¬å–ï¼Ÿ
```bash
cd /Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp
rm -rf crawled_data  # æ¸…é™¤æ—§æ•°æ®
python main.py crawl
```

### 2. å¦‚ä½•åªä¸Šä¼ æ–°æ–‡ç« ï¼Ÿ
Elasticsearchä¼šè‡ªåŠ¨å»é‡ï¼Œç›´æ¥è¿è¡Œä¸Šä¼ å³å¯ï¼š
```bash
python upload_crawled_articles.py processed_articles.json
```

### 3. å¦‚ä½•éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼Ÿ
```bash
# æ£€æŸ¥æ–‡ç« æ•°é‡
ls -d crawled_data/articles/*/ | wc -l  # åº”è¯¥æ˜¯180

# æ£€æŸ¥æœ‰å†…å®¹çš„æ–‡ç« 
find crawled_data/articles -name "content.md" -size +0 | wc -l  # åº”è¯¥æ˜¯180

# æ£€æŸ¥å›¾ç‰‡
find crawled_data/articles -path "*/images/*" -type f | wc -l  # åº”è¯¥æ˜¯600+
```

### 4. å›¾ç‰‡URLå¦‚ä½•å¤„ç†ï¼Ÿ
- çˆ¬è™«å·²å°†æ‰€æœ‰å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°
- Markdownä¸­çš„å›¾ç‰‡é“¾æ¥å·²æ›´æ–°ä¸ºæœ¬åœ°è·¯å¾„
- ä¸Šä¼ åˆ°MinIOåä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºå…¬å¼€URL

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### çˆ¬è™«é…ç½®ä¼˜åŒ–
```json
{
  "crawler": {
    "max_concurrent_articles": 2,  // ä¸å»ºè®®è¶…è¿‡3
    "max_concurrent_images": 5,    // å¯ä»¥å¢åŠ åˆ°10
    "batch_size": 5,              // 5-10æœ€ä½³
    "article_delay": 0.5,          // é˜²æ­¢è§¦å‘é™æµ
    "enable_resume": true          // å¯ç”¨æ–­ç‚¹ç»­ä¼ 
  }
}
```

### Elasticsearchæ‰¹é‡ä¸Šä¼ 
```python
# åˆ†æ‰¹ä¸Šä¼ ï¼Œé¿å…å†…å­˜æº¢å‡º
batch_size = 50  # æ¯æ‰¹50ç¯‡
for i in range(0, len(articles), batch_size):
    batch = articles[i:i+batch_size]
    await bulk_index_articles(batch)
```

## æŠ€æœ¯è¦ç‚¹

### 1. å¼‚æ­¥å¹¶å‘æ¶æ„
- ä½¿ç”¨asyncio + aiohttpå®ç°é«˜å¹¶å‘
- Semaphoreæ§åˆ¶å¹¶å‘æ•°
- é¡µé¢æ± ç®¡ç†Playwrightå®ä¾‹

### 2. å»é‡ç­–ç•¥
- æ–‡ç« IDï¼ˆä¸»é”®ï¼‰
- å†…å®¹å“ˆå¸Œï¼ˆSHA256ï¼‰
- å›¾ç‰‡å“ˆå¸Œï¼ˆMD5ï¼‰

### 3. é”™è¯¯å¤„ç†
- æŒ‡æ•°é€€é¿é‡è¯•
- æ–­ç‚¹ç»­ä¼ 
- è¯¦ç»†é”™è¯¯æ—¥å¿—

### 4. æ•°æ®è½¬æ¢
- HTML â†’ Markdown (markdownify)
- å›¾ç‰‡æœ¬åœ°åŒ–
- å…ƒæ•°æ®æå–

## åç»­å¼€å‘å»ºè®®

1. **å¢é‡æ›´æ–°**: åªçˆ¬å–æ–°å‘å¸ƒçš„æ–‡ç« 
2. **å®æ—¶åŒæ­¥**: å®šæ—¶ä»»åŠ¡è‡ªåŠ¨çˆ¬å–å¹¶ä¸Šä¼ 
3. **æ•°æ®éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
4. **æ€§èƒ½ç›‘æ§**: æ·»åŠ çˆ¬å–é€Ÿåº¦å’ŒæˆåŠŸç‡ç›‘æ§
5. **å¤šæºæ”¯æŒ**: æ‰©å±•åˆ°å…¶ä»–Newsletterç½‘ç«™

## è”ç³»ä¿¡æ¯

- çˆ¬è™«é¡¹ç›®è·¯å¾„: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/çˆ¬è™«mlp`
- MinIOé¡¹ç›®è·¯å¾„: `/Users/ruanchuhao/Downloads/Codes/NewsLetters/åˆ†æ­¥éª¤å®ç°MVP /Minioçš„è¿æ¥`
- æ•°æ®æ›´æ–°æ—¶é—´: 2025-08-07

---

*æœ¬æ–‡æ¡£ç”¨äºå¿«é€Ÿç†è§£å’Œä½¿ç”¨Newsletterçˆ¬è™«ç³»ç»Ÿï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿé¡ºåˆ©é›†æˆåˆ°MinIOå’ŒElasticsearchä¸­ã€‚*