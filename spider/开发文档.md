ThinkAI AI NewsLetters 开发环境说明文档
系统架构概述
ThinkAI是一个基于MVP（最小可行产品）架构的AI新闻处理系统，采用（Platform in Platform）设计模式，主要包含以下核心功能模块：
- 文件存储：支持文件的增删改查和AI清洗
- 文章处理：包含转码、多存储、标签处理
- 用户管理：冷启动、埋点、推荐系统
- 新闻获取：模糊搜索和各种API接口
开发环境访问信息
1. MinIO 对象存储服务
# API端点
http://60.205.160.74:9000

# 管理控制台
http://60.205.160.74:9001

# 访问凭据
用户名：thinkAI
密码：ERQO981de92@!p
用途：
- 存储图片、视频等多媒体文件
- 存储文档和媒体文件
- 支持AI清洗功能
2. PostgreSQL 数据库
# 连接信息
主机：60.205.160.74
端口：5432（默认）
数据库：thinkinai

# 访问凭据
用户名：postgres
密码：uro@#wet8332@
用途：
- 存储用户元信息
- 存储文章元数据
- 存储用户标签和埋点数据
- 支持冷启动和推荐系统
3. Elasticsearch 搜索引擎
# 服务地址
http://60.205.160.74:9200

# 访问凭据
elastic (超级用户)：8ErO981de92@!p
kibana_system：8228347+1s
logstash_system：8228347+1s
beats_system：8228347+1s
apm_system：8228347+1s
remote_monitoring_user：8228347+1s

docker run -p 5601:5601 -d \
  -e "ELASTICSEARCH_HOSTS=http://60.205.160.74:9200" \
  -e "ELASTICSEARCH_USERNAME=kibana_system" \
  -e "ELASTICSEARCH_PASSWORD=NewSecurePassword123!" \
  -e "ELASTICSEARCH_SSL_VERIFICATIONMODE=none" \
  docker.elastic.co/kibana/kibana:8.11.0
用途：
- 存储文档全文索引
- 支持模糊搜索功能
- 提供搜索API接口
开发环境配置
1. 环境变量配置
# 创建环境变量文件
cat > .env << EOF
# MinIO配置
MINIO_ENDPOINT=http://60.205.160.74:9000
MINIO_ACCESS_KEY=thinkAI
MINIO_SECRET_KEY=ERQO981de92@!p
MINIO_BUCKET=thinkai-dev

# PostgreSQL配置
PG_HOST=60.205.160.74
PG_PORT=5432
PG_DATABASE=postgres
PG_USERNAME=postgres
PG_PASSWORD=uro@#wet8332@

# Elasticsearch配置
ES_HOST=http://60.205.160.74:9200
ES_USERNAME=elastic
ES_PASSWORD=8ErO981de92@!p
ES_INDEX_PREFIX=thinkai_dev

# 应用配置
APP_ENV=development
APP_DEBUG=true
EOF
2. 连接测试脚本
#!/bin/bash
echo "=== ThinkAI 开发环境连接测试 ==="

echo "1. 测试MinIO连接..."
curl -I http://60.205.160.74:9000/minio/health/live

echo -e "\n2. 测试PostgreSQL连接..."
psql -h 60.205.160.74 -U postgres -d postgres -c "SELECT version();"

echo -e "\n3. 测试Elasticsearch连接..."
curl -k -u elastic:8ErO981de92@!p -X GET "http://60.205.160.74:9200"

echo -e "\n=== 测试完成 ==="
API接口说明
1. 爬虫API
# 启动爬虫任务
curl -X POST "http://api.thinkai.com/crawler/start" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com/article", "type": "article"}'

# 获取爬虫状态
curl -X GET "http://api.thinkai.com/crawler/status/{task_id}"

# 获取爬虫结果
curl -X GET "http://api.thinkai.com/crawler/result/{task_id}"

# 批量爬取文章
curl -X POST "http://api.thinkai.com/crawler/batch" \
  -H "Content-Type: application/json" \
  -d '{"urls": ["url1", "url2"], "type": "article"}'
2. 文件存储API
# 上传文件
curl -X POST "http://60.205.160.74:9000/upload" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@local_file.jpg"

# 下载文件
curl -X GET "http://60.205.160.74:9000/download/filename.jpg"

# 删除文件
curl -X DELETE "http://60.205.160.74:9000/delete/filename.jpg"

# 上传Markdown文件
curl -X POST "http://60.205.160.74:9000/upload/md" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@article.md" \
  -F "metadata={\"title\":\"文章标题\",\"author\":\"作者\"}"
3. 文章处理API
# 文章转码为Markdown
curl -X POST "http://api.thinkai.com/articles/transcode" \
  -H "Content-Type: application/json" \
  -d '{"url": "article_url", "format": "markdown", "extract_media": true}'

# 获取文章列表
curl -X GET "http://api.thinkai.com/articles?page=1&size=20"

# 搜索文章（基于Elasticsearch）
curl -X GET "http://api.thinkai.com/articles/search?q=关键词&highlight=true&page=1&size=20"

# 高级搜索（支持多字段筛选）
curl -X POST "http://api.thinkai.com/articles/search/advanced" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "关键词",
    "filters": {
      "author": "作者名",
      "date_range": {"start": "2025-01-01", "end": "2025-08-01"},
      "tags": ["科技", "AI"]
    },
    "sort": "relevance",
    "page": 1,
    "size": 20
  }'

# 获取文章详情
curl -X GET "http://api.thinkai.com/articles/{article_id}"

# 更新文章元数据
curl -X PUT "http://api.thinkai.com/articles/{article_id}/metadata" \
  -H "Content-Type: application/json" \
  -d '{"title": "新标题", "tags": ["科技", "AI"]}'

# 搜索接口实现说明
# 1. 基础搜索：GET /articles/search
#    - 参数：q(关键词), page(页码), size(每页数量), highlight(是否高亮)
#    - 返回：文章列表（包含元数据和内容片段）

# 2. 高级搜索：POST /articles/search/advanced
#    - 支持复杂查询条件和筛选
#    - 支持排序和分页
#    - 返回：完整的搜索结果

# 3. 搜索建议：GET /articles/search/suggest
#    - 参数：q(输入关键词)
#    - 返回：搜索建议列表

### **4. 用户管理API**

```bash
# 用户冷启动标签选择
curl -X POST "http://api.thinkai.com/users/cold-start" \
  -H "Content-Type: application/json" \
  -d '{"user_id": "123", "tags": ["科技", "AI"]}'

# 用户埋点
curl -X POST "http://api.thinkai.com/users/tracking" \
  -H "Content-Type: application/json" \
  -d '{"user_id": "123", "event": "article_view", "data": {...}}'

# 获取推荐
curl -X GET "http://api.thinkai.com/users/123/recommendations"
开发工具配置
1. 数据库管理工具
# 使用pgAdmin连接PostgreSQL
主机：60.205.160.74
端口：5432
用户名：postgres
密码：uro@#wet8332@
[图片]
2. 对象存储管理
# 使用MinIO Client
mc config host add thinkai-dev http://60.205.160.74:9000 thinkAI ERQO981de92@!p
mc ls thinkai-dev
3. 搜索引擎管理
# 使用Kibana（如果部署）
http://60.205.160.74:5601

# 使用Elasticsearch API
curl -k -u elastic:8ErO981de92@!p -X GET "http://60.205.160.74:9200/_cat/indices"
开发流程
1. 文件处理流程
[图片]
流程说明：
- 爬虫获取文章：通过爬虫系统获取原始文章内容
- 资源存储MinIO：将文章中的图片、视频等多媒体资源存储到MinIO
- 文章转MD格式：将原始文章转换为Markdown格式
- MD存储MinIO：将转换后的Markdown文件存储到MinIO
- 元数据存储PG：将文章的基本信息（标题、作者、发布时间等）存储到PostgreSQL
- 内容存储ES：将文章全文内容存储到Elasticsearch用于全文检索
 
3. 搜索接口处理流程
[图片]
流程说明：
- 用户搜索请求：接收用户的搜索关键词和筛选条件
- Elasticsearch全文搜索：在ES中搜索文章内容，返回匹配的文章ID和相关性评分
- 获取文章ID列表：从ES搜索结果中提取文章ID列表
- PostgreSQL获取元数据：根据文章ID从PG中获取文章的元数据（标题、作者、发布时间等）
- MinIO获取Markdown内容：根据文章ID从MinIO中获取文章的Markdown内容
- 组装搜索结果：将元数据和内容组装成完整的搜索结果
- 返回给用户：将组装好的搜索结果返回给用户
4. 用户交互流程
[图片]
系统功能模块
爬虫模块
- 文章获取：通过爬虫系统获取原始文章内容
- 资源提取：提取文章中的图片、视频等多媒体资源
- 内容清洗：AI提供的内容清洗和格式化服务
- 任务管理：爬虫任务的创建、监控和结果获取
文件存储模块
- 存：文件上传和存储
- 取：文件下载和访问
- 删：文件删除和清理
- 改：文件更新和修改
- 多媒体存储：图片和视频等多媒体资源存储在MinIO
- Markdown存储：转换后的Markdown文件存储在MinIO
文章处理模块
- 转码：将原始文章转换为Markdown格式
- 多处存储：
  - 元信息存入PostgreSQL
  - 多媒体资源存入MinIO
  - Markdown文件存入MinIO
  - 全文内容存入Elasticsearch
- 标签处理：文章标签存入PostgreSQL
用户模块
- 冷启动选标签：新用户标签选择
- 埋点：用户行为数据收集
- 推荐：用户标签推荐文档
获取新闻模块
- 模糊搜索：基于Elasticsearch的全文搜索功能
- 搜索流程：
  1. Elasticsearch全文搜索获取文章ID
  2. PostgreSQL获取文章元数据
  3. MinIO获取文章Markdown内容
  4. 组装完整搜索结果返回
- 接口：
  - 爬虫接口：启动爬虫任务、获取爬虫状态和结果
  - 列表接口：获取文章列表
  - 搜索接口：
    - 基础搜索：关键词全文搜索
    - 高级搜索：多条件筛选搜索
    - 搜索建议：智能搜索提示
  - 文本展示接口：展示文章Markdown内容
  - 交互接口：用户交互功能
  - 埋点接口：用户行为数据收集
注意事项
1. 安全提醒
- 所有密码仅用于开发环境
- 生产环境请使用更强的密码
- 定期更换访问凭据
- 不要在代码中硬编码密码
2. 性能优化
- 大文件上传建议使用分片上传
- 数据库查询建议添加索引
- 搜索查询建议使用缓存
- 定期清理临时文件
- 搜索性能优化：
  - Elasticsearch索引优化和分片配置
  - 搜索结果缓存机制
  - 批量获取元数据和内容的并行处理
  - 搜索结果的懒加载和分页优化
3. 监控告警
- 监控各服务状态
- 设置磁盘空间告警
- 监控API响应时间
- 设置错误率告警
故障排除
常见问题
1. 连接超时
# 检查网络连通性
ping 60.205.160.74
telnet 60.205.160.74 9000
telnet 60.205.160.74 5432
telnet 60.205.160.74 9200
2. 认证失败
# 验证MinIO凭据
curl -u thinkAI:ERQO981de92@!p http://60.205.160.74:9000

# 验证PostgreSQL连接
psql -h 60.205.160.74 -U postgres -d postgres -c "SELECT 1;"

# 验证Elasticsearch连接
curl -k -u elastic:8ErO981de92@!p -X GET "http://60.205.160.74:9200"
3. 服务不可用
# 检查服务状态
curl -I http://60.205.160.74:9200
curl -I http://60.205.160.74:9000
日志查看
# 查看系统日志
journalctl -u docker -f
更新日志
版本
日期
更新内容
更新人
v1.0
2025-08-01
初始版本，包含基础配置和API说明
ThinkAI开发团队
v1.1
2025-08-01
添加故障排除和监控告警
ThinkAI开发团队
v1.2
2025-08-01
完善文件处理流程，添加爬虫模块和详细存储说明
ThinkAI开发团队
v1.3
2025-08-01
完善搜索接口处理流程，添加详细搜索步骤和性能优化
ThinkAI开发团队

---
文档版本：v1.3
最后更新：2025-08-01
维护人员：ThinkAI开发团队
文档状态：开发环境配置完成